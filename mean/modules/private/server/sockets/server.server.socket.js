"use strict";function SocketsCtrl(){EventEmitter.call(this)}var path=require("path"),fs=require("fs"),EventEmitter=require("events"),sequelize=require(path.resolve("./config/lib/sequelize")),GroupSocket=require(path.resolve("./modules/private/server/sockets/groupsocket.server.socket")),usersCtrl=require(path.resolve("./modules/private/server/controllers/users-control.server.controller")),logger=require(path.resolve("./config/lib/logger")).getLogger("def.socketio.server");SocketsCtrl.prototype=Object.create(EventEmitter.prototype);var socketsCtrl=new SocketsCtrl;module.exports=socketsCtrl,socketsCtrl.groupSocket=new GroupSocket,socketsCtrl.EVENTTYPE={NEWSOCKET:"newSocket"},usersCtrl.on(usersCtrl.USERRELOGIN,function(e){var t=socketsCtrl.groupSocket.getUserSocket(e);t&&(t.emit("USERRELOGIN"),setTimeout(function(){t.disconnect(!0)}))}),socketsCtrl.on(socketsCtrl.EVENTTYPE.NEWSOCKET,function(e,t){var r=this;logger.debug("newSocket socket connect, id %s,username %s",e.id,t.username),this.groupSocket.add("sockets",e),e.on("disconnect",function(){logger.debug("socket user %s leave.",t.username),r.groupSocket.removeAll(e)})});